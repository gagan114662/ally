# Ally Operations Policy Configuration
# This file defines operational policies for the Ally trading system

version: "1.0.0"
environment: production

# Audit and Receipt Policies
audit:
  enabled: true
  level: comprehensive
  receipt_generation: always
  proof_lines:
    - "PROOF:phase:8:ops:policy:loaded"
    - "PROOF:phase:8:receipts:generation:enabled"
    - "PROOF:phase:8:audit:trail:complete"

  retention:
    days: 90
    archive_path: "./artifacts/audit_archive"

  hash_algorithms:
    - sha256
    - blake2b

# Risk Management Policies
risk_management:
  max_position_size: 0.10  # 10% of portfolio
  max_leverage: 1.0
  stop_loss:
    enabled: true
    percentage: 0.05  # 5% stop loss

  circuit_breakers:
    daily_loss_limit: 0.10
    consecutive_losses: 5
    cooldown_period: 3600  # seconds

# Execution Policies
execution:
  order_types:
    - market
    - limit
    - stop

  routing:
    smart_routing: true
    venue_priority:
      - primary
      - secondary
      - dark_pool

  slippage_tolerance: 0.001  # 0.1%

  retry_policy:
    max_attempts: 3
    backoff_multiplier: 2
    max_backoff: 30  # seconds

# Data Quality Policies
data_quality:
  validation:
    enabled: true
    check_timestamps: true
    check_ranges: true
    check_completeness: true

  outlier_detection:
    method: iqr
    threshold: 3.0

  missing_data:
    strategy: forward_fill
    max_gap: 5  # periods

# Portfolio Constraints
portfolio:
  constraints:
    max_assets: 100
    min_asset_weight: 0.001
    max_asset_weight: 0.10

  rebalancing:
    frequency: daily
    threshold: 0.05  # 5% deviation triggers rebalance

  diversification:
    min_correlation: -0.95
    max_correlation: 0.95
    sector_limits:
      technology: 0.30
      healthcare: 0.25
      finance: 0.25
      other: 1.0

# Monitoring and Alerting
monitoring:
  health_checks:
    interval: 60  # seconds
    endpoints:
      - "/health"
      - "/metrics"
      - "/status"

  alerts:
    channels:
      - console
      - file
      - webhook

    thresholds:
      error_rate: 0.01
      latency_p99: 1000  # ms
      memory_usage: 0.90

# Compliance and Governance
compliance:
  regulatory:
    jurisdiction: "US"
    frameworks:
      - "MiFID II"
      - "Reg NMS"
      - "GDPR"

  reporting:
    frequency: daily
    formats:
      - json
      - csv
      - pdf

  audit_trail:
    immutable: true
    encryption: true
    signature_required: true

# Performance Benchmarks
benchmarks:
  sharpe_ratio:
    target: 1.5
    minimum: 0.5

  max_drawdown:
    warning: 0.15
    critical: 0.25

  win_rate:
    target: 0.55
    minimum: 0.45

# Feature Flags
features:
  walk_forward_validation: true
  time_series_cv: true
  monte_carlo_simulation: true
  bootstrap_confidence: true
  kelly_sizing: true
  ensemble_models: true
  meta_learning: true
  evolutionary_optimization: true
  fdr_control: true

# System Limits
limits:
  max_concurrent_orders: 100
  max_api_calls_per_second: 10
  max_memory_gb: 16
  max_cpu_cores: 8
  max_storage_gb: 1000

# Disaster Recovery
disaster_recovery:
  backup:
    enabled: true
    frequency: hourly
    retention_days: 30

  failover:
    automatic: true
    max_downtime_seconds: 300

  data_recovery:
    rpo_minutes: 15  # Recovery Point Objective
    rto_minutes: 60  # Recovery Time Objective

# Security Policies
security:
  authentication:
    method: api_key
    rotation_days: 90

  encryption:
    at_rest: true
    in_transit: true
    algorithm: AES-256

  access_control:
    rbac_enabled: true
    audit_access: true

# Development and Testing
development:
  test_coverage:
    minimum: 0.80
    target: 0.95

  code_quality:
    linting: true
    type_checking: true
    security_scanning: true

  ci_cd:
    automated_testing: true
    automated_deployment: false
    rollback_enabled: true